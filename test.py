import os
import codecs
import pandas as pd
import collections
import json

# ip = input("ip: ")
ip = "192.168.159.137"
# os.system("./nmapAutomator.sh {} Vulns".format(ip))

local_file = os.path.join("/home/kali/Desktop/AIExploit/"+ip, 'nmapAutomator_'+ip+'_Vulns.txt')
fin = codecs.open(local_file, 'r', 'utf-8')
arr=[]
for sess in fin:
    arr.append(sess)
i=0
vnlarr = []
while i<len(arr) :
    vnldict = {'port':0, 'exploit':''}
    if "VULNERABLE" in arr[i]:
        j=1
        while True:
            if "/tcp" in arr[i-j]:
                port = arr[i-j].replace("|","").replace(":","").strip().split('/')
                print(port)
                vnldict['port'] = port[0]
                break
            j+=1

        if "-" in arr[i-1] and ":"in arr[i-1]:
            vnldict['exploit'] = arr[i-1].replace("|","").replace(":","").strip()
        vnlarr.append(vnldict)
    i+=1
# vnlarr = [item for item, count in collections.Counter(vnlarr['exploit']).items() if count >= 1]
i=0
while i<len(vnlarr) :
    if vnlarr[i]['exploit'] == '':
        vnlarr.pop(i)
    i+=1
print(vnlarr)

fin.close()

saved_file = os.path.join("/home/kali/Desktop/AIExploit/data", 'nmapAutomator_'+ip+'_Vulns.json')

fout = codecs.open(saved_file, 'w', 'utf-8')
# for vnl in vnlarr:
    # fout.write(vnl + '\n')
json.dump(vnlarr, fout, indent=4)
fout.close()  



# ser_file = os.path.join("/home/kali/Desktop/AIExploit/data", 'services.csv')
# ser = pd.read_csv(ser_file)
# vnl_file = os.path.join("/home/kali/Desktop/AIExploit/data", 'nmapAutomator_'+ip+'_Vulns.csv')
# vnl = pd.read_csv(vnl_file)
# for col in ser.columns:
#     sername = ser[col].tolist()
# for col in vnl.columns:
#     vnlname = vnl[col].tolist()

# for ser in sername:
#     for vnl in vnlname:
#         if ser in vnl:
#             print('')


# full_path = os.getcwd()
# print(full_path)
    